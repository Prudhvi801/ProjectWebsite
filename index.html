<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PoseAI - Create Account</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        brand: {
                            50: '#f0fdfa', 100: '#ccfbf1', 500: '#14b8a6', 
                            600: '#0d9488', 700: '#0f766e', 900: '#134e4a',
                        }
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #f3f4f6; }
        .floating-input:placeholder-shown + .floating-label { transform: translateY(0) scale(1); color: #9ca3af; }
        .floating-input:not(:placeholder-shown) + .floating-label,
        .floating-input:focus + .floating-label { transform: translateY(-1.5rem) scale(0.85); color: #0d9488; }
        .tech-bg {
            background-color: #0f766e;
            background-image: radial-gradient(circle at 20% 50%, rgba(255,255,255,0.1) 0%, transparent 25%),
                              radial-gradient(circle at 80% 20%, rgba(20, 184, 166, 0.2) 0%, transparent 30%);
        }
        .chat-scroll::-webkit-scrollbar { width: 6px; }
        .chat-scroll::-webkit-scrollbar-track { background: transparent; }
        .chat-scroll::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 bg-gray-50 relative">

    <div class="bg-white rounded-2xl shadow-2xl overflow-hidden max-w-4xl w-full flex flex-col md:flex-row min-h-[600px] relative z-10">
        <!-- Left Side: Visuals -->
        <div class="hidden md:flex md:w-1/2 tech-bg relative flex-col items-center justify-center p-12 text-white text-center">
            <div class="absolute inset-0 overflow-hidden opacity-20 pointer-events-none">
                <svg class="absolute top-10 left-10 w-24 h-24 animate-pulse-slow text-teal-300" fill="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="2"/></svg>
                <svg class="absolute bottom-20 right-10 w-32 h-32 animate-pulse-slow text-teal-200" style="animation-delay: 1s;" fill="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="4"/></svg>
            </div>
            <div class="relative z-10 animate-float">
                <div class="w-24 h-24 bg-white/10 backdrop-blur-md rounded-full flex items-center justify-center mx-auto mb-6 border border-white/20 shadow-lg">
                    <i class="ph ph-heart-beat text-5xl text-teal-100"></i>
                </div>
                <h2 class="text-3xl font-bold mb-3 tracking-tight">Join PoseAI</h2>
                <p class="text-teal-100 text-lg leading-relaxed max-w-xs mx-auto mb-8">
                    Start your journey to better posture and health with real-time AI analysis.
                </p>
                <div class="bg-white/10 backdrop-blur-sm rounded-xl p-4 border border-white/20 max-w-xs mx-auto">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-xs font-semibold uppercase tracking-wider text-teal-200">âœ¨ AI Wellness Tip</span>
                        <button onclick="generateZen()" class="text-xs bg-white/20 hover:bg-white/30 px-2 py-1 rounded transition-colors"><i class="ph ph-arrows-clockwise"></i> Refresh</button>
                    </div>
                    <p id="zenText" class="text-sm italic text-white/90 min-h-[40px] flex items-center justify-center">"Get a quick wellness tip while you sign up!"</p>
                </div>
            </div>
            <div class="absolute bottom-6 text-xs text-teal-200/60">v1.0.0 &bull; Secure System</div>
        </div>

        <!-- Right Side: Signup Form -->
        <div class="w-full md:w-1/2 p-8 md:p-12 flex flex-col justify-center bg-white relative">
            <div class="mb-8 text-center md:text-left">
                <div class="md:hidden w-12 h-12 bg-brand-500 rounded-lg flex items-center justify-center mx-auto mb-4 text-white"><i class="ph ph-heart-beat text-2xl"></i></div>
                <h1 class="text-3xl font-bold text-gray-900">Create Account</h1>
                <p class="text-gray-500 mt-2">Enter your details to get started.</p>
            </div>

            <!-- Feedback Message Container -->
            <div id="statusMessage" class="hidden mb-6 p-4 rounded-lg flex items-start gap-3 text-sm font-medium border"></div>

            <form id="signupForm" class="space-y-6">
                <div class="relative group">
                    <input type="text" name="username" id="username" class="floating-input block w-full px-4 py-3.5 text-gray-900 bg-transparent border border-gray-300 rounded-lg appearance-none focus:outline-none focus:ring-2 focus:ring-brand-500 peer" placeholder=" " required />
                    <label for="username" class="floating-label absolute text-sm text-gray-500 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white px-2 peer-focus:px-2 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-3 pointer-events-none">Username</label>
                    <i class="ph ph-user absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                </div>
                <div class="relative group">
                    <input type="password" name="password" id="password" class="floating-input block w-full px-4 py-3.5 text-gray-900 bg-transparent border border-gray-300 rounded-lg appearance-none focus:outline-none focus:ring-2 focus:ring-brand-500 peer" placeholder=" " required />
                    <label for="password" class="floating-label absolute text-sm text-gray-500 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white px-2 peer-focus:px-2 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-3 pointer-events-none">Password</label>
                    <button type="button" onclick="togglePassword()" class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 focus:outline-none"><i id="eyeIcon" class="ph ph-eye text-xl"></i></button>
                </div>
                <div class="flex items-start">
                    <div class="flex items-center h-5"><input id="terms" type="checkbox" required class="w-4 h-4 rounded border-gray-300 text-brand-600 focus:ring-brand-500"></div>
                    <label for="terms" class="ml-2 text-sm text-gray-600">I agree to the <a href="#" class="text-brand-600 hover:underline">Terms of Service</a>.</label>
                </div>
                <button type="submit" id="submitBtn" class="w-full flex items-center justify-center px-4 py-3.5 text-white bg-brand-600 hover:bg-brand-700 focus:ring-4 focus:outline-none focus:ring-brand-300 font-semibold rounded-lg text-sm transition-all shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                    <span id="btnText">Sign Up</span>
                    <i class="ph ph-user-plus ml-2 font-bold"></i>
                    <svg id="btnLoader" class="hidden animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                </button>
            </form>
            <div class="mt-8 text-center text-sm text-gray-600">Already have an account? <a href="/login" class="font-semibold text-brand-600 hover:text-brand-500 transition-colors">Login here</a></div>
        </div>
    </div>

    <!-- Chat Widget (Simulated) -->
    <div class="fixed bottom-6 right-6 z-50 flex flex-col items-end space-y-4">
        <div id="aiChatBox" class="hidden bg-white w-80 h-96 rounded-2xl shadow-2xl flex flex-col border border-gray-200 overflow-hidden transform transition-all duration-300 origin-bottom-right">
            <div class="bg-brand-600 p-4 flex items-center justify-between text-white">
                <div class="flex items-center space-x-2"><i class="ph ph-sparkle-fill text-yellow-300"></i><span class="font-semibold text-sm">Ask PoseAI</span></div>
                <button onclick="toggleChat()" class="hover:bg-brand-700 rounded p-1"><i class="ph ph-x"></i></button>
            </div>
            <div id="chatMessages" class="flex-1 p-4 overflow-y-auto chat-scroll bg-gray-50 space-y-3 text-sm">
                <div class="flex items-start space-x-2">
                    <div class="w-8 h-8 rounded-full bg-brand-100 flex items-center justify-center flex-shrink-0"><i class="ph ph-robot text-brand-600"></i></div>
                    <div class="bg-white p-2.5 rounded-r-lg rounded-bl-lg shadow-sm border border-gray-100 text-gray-700">Hello! ðŸ‘‹ Thinking of joining? Ask me how we analyze poses or what equipment you need.</div>
                </div>
            </div>
            <div class="p-3 bg-white border-t border-gray-100">
                <div class="flex items-center space-x-2">
                    <input type="text" id="userQuery" placeholder="Ask a question..." class="flex-1 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-brand-500" onkeypress="if(event.key === 'Enter') sendQuery()">
                    <button onclick="sendQuery()" class="bg-brand-600 text-white rounded-lg p-2 hover:bg-brand-700 transition-colors"><i class="ph ph-paper-plane-right"></i></button>
                </div>
            </div>
        </div>
        <button onclick="toggleChat()" class="group flex items-center justify-center w-14 h-14 bg-brand-600 text-white rounded-full shadow-lg hover:bg-brand-700 transition-all hover:scale-105 active:scale-95 animate-bounce-slight hover:animate-none">
            <i class="ph ph-chat-teardrop-text text-2xl group-hover:hidden"></i><i class="ph ph-caret-down text-2xl hidden group-hover:block"></i>
        </button>
    </div>

    <!-- Scripts -->
    <script>
        // API Key (Runtime provided)
        const apiKey = "";
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        async function callGemini(prompt) {
            if (!apiKey) return "âœ¨ [Demo] Enable API key for real AI. " + prompt;
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                if (!response.ok) throw new Error("API call failed");
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) { return "Sorry, I'm meditating right now (Connection Error)."; }
        }

        async function generateZen() {
            const zenText = document.getElementById('zenText');
            zenText.innerHTML = '<i class="ph ph-spinner animate-spin"></i> Seeking wellness...';
            const prompt = "Generate a short, unique, healthy lifestyle tip for someone starting yoga. Add one emoji.";
            const text = await callGemini(prompt);
            zenText.innerText = text;
        }

        function toggleChat() {
            const chatBox = document.getElementById('aiChatBox');
            chatBox.classList.toggle('hidden');
            if (!chatBox.classList.contains('hidden')) document.getElementById('userQuery').focus();
        }

        async function sendQuery() {
            const input = document.getElementById('userQuery');
            const messages = document.getElementById('chatMessages');
            const userText = input.value.trim();
            if (!userText) return;
            // Add User Message
            messages.innerHTML += `<div class="flex items-start justify-end space-x-2"><div class="bg-brand-600 text-white p-2.5 rounded-l-lg rounded-br-lg shadow-sm text-gray-700 max-w-[85%] text-left">${userText}</div></div>`;
            input.value = '';
            messages.scrollTop = messages.scrollHeight;
            // AI Response
            const aiResponse = await callGemini("Keep answers short. User: " + userText);
            messages.innerHTML += `<div class="flex items-start space-x-2"><div class="w-8 h-8 rounded-full bg-brand-100 flex items-center justify-center flex-shrink-0"><i class="ph ph-robot text-brand-600"></i></div><div class="bg-white p-2.5 rounded-r-lg rounded-bl-lg shadow-sm border border-gray-100 text-gray-700">${marked.parse(aiResponse)}</div></div>`;
            messages.scrollTop = messages.scrollHeight;
        }

        function togglePassword() {
            const pw = document.getElementById('password');
            const icon = document.getElementById('eyeIcon');
            pw.type = pw.type === 'password' ? 'text' : 'password';
            icon.classList.toggle('ph-eye');
            icon.classList.toggle('ph-eye-slash');
        }

        // --- SIGNUP LOGIC ---
        document.getElementById('signupForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const btn = document.getElementById('submitBtn');
            const btnText = document.getElementById('btnText');
            const btnLoader = document.getElementById('btnLoader');
            const statusBox = document.getElementById('statusMessage');

            // 1. Show Loading
            btnText.classList.add('hidden');
            document.querySelector('.ph-user-plus').classList.add('hidden');
            btnLoader.classList.remove('hidden');
            btn.disabled = true;
            statusBox.classList.add('hidden');

            // Get form data
            const formData = new FormData(this);
            const jsonData = Object.fromEntries(formData.entries());

            try {
                // Send data to Flask backend
                const response = await fetch('/signup', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(jsonData)
                });
                
                const result = await response.json();

                if (result.success) {
                    // SUCCESS: Show Green Message & Redirect
                    statusBox.innerHTML = '<i class="ph-fill ph-check-circle text-xl"></i> Account created successfully! Redirecting to Login...';
                    statusBox.className = "mb-6 p-4 rounded-lg flex items-start gap-3 text-sm font-medium border bg-green-50 text-green-600 border-green-200";
                    
                    setTimeout(() => {
                        window.location.href = result.redirect;
                    }, 1500);
                } else {
                    // ERROR: Show Red Message (e.g. "Username exists")
                    statusBox.innerHTML = `<i class="ph-fill ph-warning-circle text-xl"></i> ${result.message}`;
                    statusBox.className = "mb-6 p-4 rounded-lg flex items-start gap-3 text-sm font-medium border bg-red-50 text-red-600 border-red-200";
                    
                    // Reset button
                    btnText.classList.remove('hidden');
                    document.querySelector('.ph-user-plus').classList.remove('hidden');
                    btnLoader.classList.add('hidden');
                    btn.disabled = false;
                }
            } catch (error) {
                console.error("Network error:", error);
                statusBox.innerHTML = `<i class="ph-fill ph-warning-circle text-xl"></i> Network Error. Please try again.`;
                statusBox.className = "mb-6 p-4 rounded-lg flex items-start gap-3 text-sm font-medium border bg-red-50 text-red-600 border-red-200";

                btnText.classList.remove('hidden');
                document.querySelector('.ph-user-plus').classList.remove('hidden');
                btnLoader.classList.add('hidden');
                btn.disabled = false;
            }
        });
    </script>
</body>
</html>